<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Partition a Network Graph Into Clusters — addClusterMembership • NAIR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Partition a Network Graph Into Clusters — addClusterMembership"><meta name="description" content="Given a list of network objects returned by
    buildRepSeqNetwork() or
    generateNetworkObjects(),
    partitions the network graph into clusters using the specified clustering
    algorithm, adding a cluster membership variable to the node metadata."><meta property="og:description" content="Given a list of network objects returned by
    buildRepSeqNetwork() or
    generateNetworkObjects(),
    partitions the network graph into clusters using the specified clustering
    algorithm, adding a cluster membership variable to the node metadata."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">NAIR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.4.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/NAIR.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/buildRepSeqNetwork.html">buildRepSeqNetwork()/buildNet()</a></li>
    <li><a class="dropdown-item" href="../articles/node_properties.html">Node-Level Network Properties</a></li>
    <li><a class="dropdown-item" href="../articles/cluster_analysis.html">Cluster Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/network_visualization.html">Network Visualization</a></li>
    <li><a class="dropdown-item" href="../articles/supplementary.html">Supplementary Functions</a></li>
    <li><a class="dropdown-item" href="../articles/dual_chain.html">Dual-Chain Network Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/associated_clusters.html">Searching for Associated TCR/BCR Clusters</a></li>
    <li><a class="dropdown-item" href="../articles/public_clusters.html">Searching for Public TCR/BCR Clusters</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mlizhangx/Network-Analysis-for-Repertoire-Sequencing-/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Partition a Network Graph Into Clusters</h1>

      <div class="d-none name"><code>addClusterMembership.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Given a list of network objects returned by
    <code><a href="buildRepSeqNetwork.html">buildRepSeqNetwork()</a></code> or
    <code><a href="generateNetworkObjects.html">generateNetworkObjects()</a></code>,
    partitions the network graph into clusters using the specified clustering
    algorithm, adding a cluster membership variable to the node metadata.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">addClusterMembership</span><span class="op">(</span></span>
<span>  <span class="va">net</span>,</span>
<span>  cluster_fun <span class="op">=</span> <span class="st">"fast_greedy"</span>,</span>
<span>  cluster_id_name <span class="op">=</span> <span class="st">"cluster_id"</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  data <span class="op">=</span> <span class="fu">deprecated</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  fun <span class="op">=</span> <span class="fu">deprecated</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-net">net<a class="anchor" aria-label="anchor" href="#arg-net"></a></dt>
<dd><p>A <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></code> of network objects conforming to the output of
      <code><a href="buildRepSeqNetwork.html">buildRepSeqNetwork()</a></code> or
      <code><a href="generateNetworkObjects.html">generateNetworkObjects()</a></code>.
      See details.
      Alternatively, this argument accepts the network
      <code><a href="https://r.igraph.org/reference/aaa-igraph-package.html" class="external-link">igraph</a></code>, with the node metadata passed to the
      <code>data</code> argument. However, this alternative functionality is
      deprecated and will eventually be removed.</p></dd>

  <dt id="arg-cluster-fun">cluster_fun<a class="anchor" aria-label="anchor" href="#arg-cluster-fun"></a></dt>
<dd><p>A character string specifying the clustering algorithm to use.
      See details.</p></dd>

  <dt id="arg-cluster-id-name">cluster_id_name<a class="anchor" aria-label="anchor" href="#arg-cluster-id-name"></a></dt>
<dd><p>A character string specifying the name of the cluster membership variable
      to be added to the node metadata.</p></dd>

  <dt id="arg-overwrite">overwrite<a class="anchor" aria-label="anchor" href="#arg-overwrite"></a></dt>
<dd><p>Logical. Should the variable specified by <code>cluster_id_name</code> be
      overwritten if it already exists?</p></dd>

  <dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, generates messages about the tasks
      performed and their progress, as well as relevant properties of intermediate
      outputs. Messages are sent to <code><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">stderr()</a></code>.</p></dd>

  <dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Named optional arguments to the function specified by <code>cluster_fun</code>.</p></dd>

  <dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated" class="external-link"><img src="figures/lifecycle-deprecated.svg" alt="[Deprecated]"></a>
      See <code>net</code>.</p></dd>

  <dt id="arg-fun">fun<a class="anchor" aria-label="anchor" href="#arg-fun"></a></dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated" class="external-link"><img src="figures/lifecycle-deprecated.svg" alt="[Deprecated]"></a>
      Replaced by <code>cluster_fun</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The list <code>net</code> must contain the named elements
    <code>igraph</code> (of class <code><a href="https://r.igraph.org/reference/aaa-igraph-package.html" class="external-link">igraph</a></code>),
    <code>adjacency_matrix</code> (a <code><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></code> or
    <code><a href="https://rdrr.io/pkg/Matrix/man/dgCMatrix-class.html" class="external-link">dgCMatrix</a></code> encoding edge connections),
    and <code>node_data</code> (a <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></code> containing node metadata),
    all corresponding to the same network. The lists returned by
    <code><a href="buildRepSeqNetwork.html">buildRepSeqNetwork()</a></code> and
    <code><a href="generateNetworkObjects.html">generateNetworkObjects()</a></code>
    are examples of valid inputs for the <code>net</code> argument.</p>
<p>Alternatively, the <code>igraph</code> may be passed to <code>net</code> and the node
    metadata to <code>data</code>. However, this alternative functionality is
    deprecated and will eventually be removed.</p>
<p>A clustering algorithm is used to partition the network graph into clusters
    (densely-connected subgraphs). Each cluster represents a collection of
    clones/cells with similar receptor sequences. The method used to partition
    the graph depends on the choice of clustering algorithm, which is specified
    using the <code>cluster_fun</code> argument.</p>
<p>The available options for <code>cluster_fun</code> are listed below. Each refers
    to an <code><a href="https://r.igraph.org/reference/aaa-igraph-package.html" class="external-link">igraph</a></code> function implementing a
    particular clustering algorithm. Follow the links to learn more about the
    individual clustering algorithms.</p>
<p></p><ul><li><p><code><a href="https://r.igraph.org/reference/cluster_edge_betweenness.html" class="external-link">"edge_betweenness"</a></code></p></li>
<li><p><code><a href="https://r.igraph.org/reference/cluster_fast_greedy.html" class="external-link">"fast_greedy"</a></code></p></li>
<li><p><code><a href="https://r.igraph.org/reference/cluster_infomap.html" class="external-link">"infomap"</a></code></p></li>
<li><p><code><a href="https://r.igraph.org/reference/cluster_label_prop.html" class="external-link">"label_prop"</a></code></p></li>
<li><p><code><a href="https://r.igraph.org/reference/cluster_leading_eigen.html" class="external-link">"leading_eigen"</a></code></p></li>
<li><p><code><a href="https://r.igraph.org/reference/cluster_leiden.html" class="external-link">"leiden"</a></code></p></li>
<li><p><code><a href="https://r.igraph.org/reference/cluster_louvain.html" class="external-link">"louvain"</a></code></p></li>
<li><p><code><a href="https://r.igraph.org/reference/cluster_optimal.html" class="external-link">"optimal"</a></code></p></li>
<li><p><code><a href="https://r.igraph.org/reference/cluster_spinglass.html" class="external-link">"spinglass"</a></code></p></li>
<li><p><code><a href="https://r.igraph.org/reference/cluster_walktrap.html" class="external-link">"walktrap"</a></code></p></li>
</ul><p>Optional arguments to each clustering algorithm can have their
    values specified using the ellipses (<code>...</code>) argument of
    <code>addClusterMembership()</code>.</p>
<p>Each cluster is assigned a numeric cluster ID. A cluster membership variable,
    whose name is specified by <code>cluster_id_name</code>, is added to the node
    metadata, encoding the cluster membership of the node for each row. The cluster
    membership is encoded as the cluster ID number of the cluster to which the node
    belongs.</p>
<p>The <code>overwrite</code> argument controls whether to overwrite pre-existing data.
    If the variable specified by <code>cluster_id_name</code> is already present in
    the node metadata, then <code>overwrite</code> must be set to <code>TRUE</code> in
    order to perform clustering and overwrite the variable with new cluster
    membership values. Alternatively, by specifying a value for
    <code>cluster_id_name</code> that is not among the variables in the node metadata,
    a new cluster membership variable can be created while preserving the old
    cluster membership variable. In this manner, clustering can be performed
    multiple times on the same network using different clustering algorithms,
    without losing the results.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>If the variable specified by <code>cluster_id_name</code> is not present in
    <code>net$node_data</code>, returns a copy of <code>net</code> with this variable
    added to <code>net$node_data</code> encoding the cluster membership of the network
    node corresponding to each row. If the variable is already present and
    <code>overwrite = TRUE</code>, then its values are replaced with the new values
    for cluster membership.</p>
<p>Additionally, if <code>net</code> contains a list named <code>details</code>, then the
    following elements will be added to <code>net$details</code> if they do not
    already exist:</p>
<p></p>
<dl><dt><code>clusters_in_network</code></dt>
<dd><p>A named numeric vector of length 1. The first entry's name is the
        name of the clustering algorithm, and its value is the number of clusters
        resulting from performing clustering on the network.</p></dd>

    <dt><code>cluster_id_variable</code></dt>
<dd><p>A named numeric vector of length 1. The first entry's name is the
        name of the clustering algorithm, and its value is the name of the
        corresponding cluster membership variable in the node metadata
        (i.e., the value of <code>cluster_id_name</code>).</p></dd>


</dl><p>If <code>net$details</code> already contains these elements, they will be updated
    according to whether the cluster membership variable specified by
    <code>cluster_id_name</code>
    is added to <code>net$node_data</code> or already exists and is overwritten.
    In the former case (the cluster membership variable does not already exist),
    the length of each vector
    (<code>clusters_in_network</code>) and (<code>cluster_id_variable</code>)
    is increased by 1, with the new information appended as a new named entry
    to each. In the latter case (the cluster membership variable is overwritten),
    the new information overwrites the name and value of the last entry of each
    vector.</p>
<p>In the event where <code>overwrite = FALSE</code> and <code>net$node_data</code> contains
    a variable with the same name as the value of <code>cluster_id_name</code>, then an
    unaltered copy of <code>net</code> is returned with a message notifying the user.</p>
<p>Under the alternative (deprecated) input format where the node metadata is
    passed to <code>data</code> and the <code>igraph</code> is passed to <code>net</code>, the
    node metadata is returned instead of the list of network objects, with the
    cluster membership variable added or updated as described above.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="addClusterStats.html">addClusterStats()</a></code>
<code><a href="addClusterLabels.html">labelClusters()</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Hai Yang, Jason Cham, Brian Neal, Zenghua Fan, Tao He and Li Zhang. (2023).
NAIR: Network Analysis of Immune Repertoire. <em>Frontiers in Immunology</em>, vol. 14.
<a href="https://www.frontiersin.org/articles/10.3389/fimmu.2023.1181825/full" class="external-link">doi: 10.3389/fimmu.2023.1181825</a></p>
<p><a href="https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/index.html">Webpage for the NAIR package</a></p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Brian Neal (<a href="mailto:Brian.Neal@ucsf.edu">Brian.Neal@ucsf.edu</a>)</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">toy_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="simulateToyData.html">simulateToyData</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="generateNetworkObjects.html">generateNetworkObjects</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">toy_data</span>, <span class="st">"CloneSeq"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Perform cluster analysis,</span></span></span>
<span class="r-in"><span><span class="co"># add cluster membership to net$node_data</span></span></span>
<span class="r-in"><span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu">addClusterMembership</span><span class="op">(</span><span class="va">net</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">net</span><span class="op">$</span><span class="va">details</span><span class="op">$</span><span class="va">clusters_in_network</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fast_greedy </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          20 </span>
<span class="r-in"><span><span class="va">net</span><span class="op">$</span><span class="va">details</span><span class="op">$</span><span class="va">cluster_id_variable</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  fast_greedy </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> "cluster_id" </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># overwrite values in net$node_data$cluster_id</span></span></span>
<span class="r-in"><span><span class="co"># with cluster membership values obtained using "cluster_leiden" algorithm</span></span></span>
<span class="r-in"><span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu">addClusterMembership</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">net</span>,</span></span>
<span class="r-in"><span>  cluster_fun <span class="op">=</span> <span class="st">"leiden"</span>,</span></span>
<span class="r-in"><span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">net</span><span class="op">$</span><span class="va">details</span><span class="op">$</span><span class="va">clusters_in_network</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> leiden </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     53 </span>
<span class="r-in"><span><span class="va">net</span><span class="op">$</span><span class="va">details</span><span class="op">$</span><span class="va">cluster_id_variable</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       leiden </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> "cluster_id" </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># perform clustering using "cluster_louvain" algorithm</span></span></span>
<span class="r-in"><span><span class="co"># saves cluster membership values to net$node_data$cluster_id_louvain</span></span></span>
<span class="r-in"><span><span class="co"># (net$node_data$cluster_id retains membership values from "cluster_leiden")</span></span></span>
<span class="r-in"><span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu">addClusterMembership</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">net</span>,</span></span>
<span class="r-in"><span>  cluster_fun <span class="op">=</span> <span class="st">"louvain"</span>,</span></span>
<span class="r-in"><span>  cluster_id_name <span class="op">=</span> <span class="st">"cluster_id_louvain"</span>,</span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">net</span><span class="op">$</span><span class="va">details</span><span class="op">$</span><span class="va">clusters_in_network</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  leiden louvain </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      53      19 </span>
<span class="r-in"><span><span class="va">net</span><span class="op">$</span><span class="va">details</span><span class="op">$</span><span class="va">cluster_id_variable</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               leiden              louvain </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "cluster_id" "cluster_id_louvain" </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Brian Neal, Hai Yang, Daniil Matveev, Phi Long Le, Li Zhang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

