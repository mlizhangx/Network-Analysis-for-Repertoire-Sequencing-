<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Given multiple samples of AIRR-Seq data containing TCR CDR3 amino acid sequences, encodes each TCR sequence as a numeric vector based on Atchley factors and performs \(K\)-means clustering on the encoded sequences. Samples are compared based on the fraction of their unique TCR sequences in each cluster."><title>Encode TCR Sequences Using Atchley Factors, Perform K-Means Clustering, Compare Samples by TCR Frequency Per Cluster — kmeansAtchley • NAIR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Encode TCR Sequences Using Atchley Factors, Perform K-Means Clustering, Compare Samples by TCR Frequency Per Cluster — kmeansAtchley"><meta property="og:description" content="Given multiple samples of AIRR-Seq data containing TCR CDR3 amino acid sequences, encodes each TCR sequence as a numeric vector based on Atchley factors and performs \(K\)-means clustering on the encoded sequences. Samples are compared based on the fraction of their unique TCR sequences in each cluster."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">NAIR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.9042</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/NAIR.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/associated_clusters.html">Searching for Associated TCR/BCR Clusters</a>
    <a class="dropdown-item" href="../articles/buildRepSeqNetwork.html">buildRepSeqNetwork</a>
    <a class="dropdown-item" href="../articles/dual_chain.html">Dual-Chain Network Analysis</a>
    <a class="dropdown-item" href="../articles/network_visualization.html">Network Visualization</a>
    <a class="dropdown-item" href="../articles/public_clusters.html">Searching for Public TCR/BCR Clusters</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mlizhangx/Network-Analysis-for-Repertoire-Sequencing-/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Encode TCR Sequences Using Atchley Factors, Perform K-Means Clustering, Compare Samples by TCR Frequency Per Cluster</h1>
      
      <div class="d-none name"><code>kmeansAtchley.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Given multiple samples of AIRR-Seq data containing TCR CDR3 amino acid sequences, encodes each TCR sequence as a numeric vector based on Atchley factors and performs \(K\)-means clustering on the encoded sequences. Samples are compared based on the fraction of their unique TCR sequences in each cluster.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">kmeansAtchley</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">amino_col</span>,</span>
<span>  <span class="va">sample_col</span>,</span>
<span>  <span class="va">group_col</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  pdf_width <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  pdf_height <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  margin_cluster_heatmap <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  margin_corr_heatmap <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  use_viridis <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  file_cluster_heatmap <span class="op">=</span></span>
<span>    <span class="st">"atchley_kmeans_TCR_fraction_per_cluster.pdf"</span>,</span>
<span>  file_corr_heatmap <span class="op">=</span></span>
<span>    <span class="st">"atchley_kmeans_correlation_heatmap.pdf"</span>,</span>
<span>  return_output <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>A data frame containing the combined AIRR-Seq data for all samples.</p></dd>

  <dt>amino_col</dt>
<dd><p>Specifies the column of <code>data</code> containing the TCR CDR3 amino acid sequence. Accepts either the column name or column index.</p></dd>

<dt>sample_col</dt>
<dd><p>Specifies the column of <code>data</code> containing the sample ID. Accepts either the column name or column index.</p></dd>

<dt>group_col</dt>
<dd><p>Specifies the column of <code>data</code> containing group IDs. Used to assign each sample to a group (e.g., treatment and control). Accepts either the column name or column index.</p></dd>

  <dt>k</dt>
<dd><p>The number of clusters to use for \(K\)-means clustering.</p></dd>

  <dt>pdf_width</dt>
<dd><p>Sets the page width when printing heatmaps to pdf. Passed to the <code>width</code> argument of the <code><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></code> function.</p></dd>

  <dt>pdf_height</dt>
<dd><p>Sets the page height when printing heatmaps to pdf. Passed to the <code>height</code> argument of the <code><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></code> function.</p></dd>

  <dt>margin_cluster_heatmap</dt>
<dd><p>The margin width of the column names and row names in the heatmap for each
    sample's fraction of TCRs per cluster.</p></dd>

  <dt>margin_corr_heatmap</dt>
<dd><p>The margin width of the column names and row names in the heatmap for the
    correlation in TCRs per cluster between samples.</p></dd>

  <dt>use_viridis</dt>
<dd><p>A logical scalar indicating whether to use the <code><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">cividis</a></code> color scale instead of the <code>RdBu</code> color scale from <code><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">RColorBrewer</a></code>. Better for greyscale printing and for viewers with common forms of color vision deficiency.</p></dd>

  <dt>output_dir</dt>
<dd><p>A file path. The directory in which to save pdf files of the two heatmaps produced.</p></dd>

  <dt>file_cluster_heatmap</dt>
<dd><p>A character string. The file name under which to save the pdf of the heatmap for each sample's fraction of TCRs per cluster.</p></dd>

  <dt>file_corr_heatmap</dt>
<dd><p>A character string. The file name under which to save the pdf of the heatmap for correlation in TCRs per cluster between samples.</p></dd>

  <dt>return_output</dt>
<dd><p>A logical scalar specifying whether to return the encoded TCR sequences, the K-means cluster membership table, and each sample's fraction of TCRs per cluster.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Each unique TCR CDR3 amino acid sequence is encoded as a 30-dimensional numeric vector using <code><a href="encodeTCRSeqsByAtchleyFactor.html">encodeTCRSeqsByAtchleyFactor</a></code>, which employs the software <a href="https://doi.org/10.1038/s41592-020-01020-3" class="external-link">TESSA</a>. \(K\)-means clustering is performed on the encoded TCR sequences from all samples, resulting in <code>k</code> clusters.</p>
<p>For each sample, the frequency distribution of its TCR sequences across the <code>k</code> clusters is recorded in a length-<code>k</code> vector, where each entry is the fraction of TCRs in a particular cluster (with all <code>k</code> entries summing to 1). Fraction of TCRs refers to the fraction of the sample's total number of unique TCR sequences.</p>
<p>The correlation in fraction of TCRs per cluster is computed between pairs of samples. This is done by pairing corresponding entries from both samples' <code>k</code>-vectors. Each of the <code>k</code> pairs of values is treated as an independent observation from a common bivariate random variable. This treats the fraction of TCRs in a cluster as a random variable, where the cluster is also considered random. It may be noted, however, that the <code>k</code> paired observations are not  actually independent, since they sum to \((1, 1)\).</p>
<p>Two heatmaps are produced for comparing the samples. The first heatmap depicts each sample's fraction of TCRs in each cluster. The second heatmap depicts the pairwise correlation between samples that is described above. In both heatmaps, each column corresponds to a sample. A colored bar appears above each column, with the color indicating the group to which the sample belongs, based on the group assignments specified by the <code>group_ids</code> argument. This aids in the detection of differences and similarities within and between groups.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>If <code>return_output = TRUE</code>, then the function returns a list containing the following items:</p>
<dl><dt>kmeans_cluster_ids</dt>
<dd><p>A data frame with two variables, <code>cdr3</code> and <code>kmeanClusterID</code>, containing the unique TCR sequences and the ID of the cluster to which each sequence belongs.</p></dd>

    <dt>encoded_values</dt>
<dd><p>A matrix returned by <code><a href="encodeTCRSeqsByAtchleyFactor.html">encodeTCRSeqsByAtchleyFactor</a></code> containing the numerically encoded vector for each TCR sequence.</p></dd>

    <dt>cluster_TCR_profiles</dt>
<dd><p>A matrix with <code>k</code> rows (each corresponding to a cluster) and one column per sample. Each column contains a particular sample's fraction of TCRs in each cluster.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>The deep learning algorithm used by <a href="https://doi.org/10.1038/s41592-020-01020-3" class="external-link">TESSA</a> was trained specifically on TCR CDR3 amino acid sequences and is not appropriate for use with other amino acid sequences.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Hai Yang, Jason Cham, Brian Neal, Zenghua Fan, Tao He and Li Zhang. (2023). NAIR: Network Analysis of Immune Repertoire. <em>Frontiers in Immunology</em>, vol. 14. <a href="https://doi.org/10.3389/fimmu.2023.1181825" class="external-link">https://doi.org/10.3389/fimmu.2023.1181825</a></p>
<p>Zhang Z, Xiong D, Wang X, Liu H, Wang T. (2021). Mapping the functional landscape of T cell receptor repertoires by single-T cell transcriptomics. <em>Nat Methods</em>, 18(1):92–9. <a href="https://doi.org/10.1038/s41592-020-01020-3" class="external-link">https://doi.org/10.1038/s41592-020-01020-3</a></p>
<p>Atchley WR, Zhao J, Fernandes AD, Druke T. (2005). Solving the protein sequence metric problem. <em>Proc Natl Acad Sci U.S.A.</em>  102(18):6395–400. <a href="https://doi.org/10.1073/pnas.0408677102" class="external-link">https://doi.org/10.1073/pnas.0408677102</a></p>
<p><a href="https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/index.html">Webpage for the NAIR package</a></p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Brian Neal (<a href="mailto:Brian.Neal@ucsf.edu">Brian.Neal@ucsf.edu</a>)</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">toy_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="simulateToyData.html">simulateToyData</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  samples <span class="op">=</span> <span class="fl">20</span>,</span></span>
<span class="r-in"><span>  sample_size <span class="op">=</span> <span class="fl">50</span>,</span></span>
<span class="r-in"><span>  prefix_length <span class="op">=</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>  prefix_chars <span class="op">=</span> <span class="st">""</span>,</span></span>
<span class="r-in"><span>  prefix_probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  affixes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CASSLGYEQYF"</span>, <span class="st">"CASSLGETQYF"</span>,</span></span>
<span class="r-in"><span>              <span class="st">"CASSLGTDTQYF"</span>, <span class="st">"CASSLGTEAFF"</span>,</span></span>
<span class="r-in"><span>              <span class="st">"CASSLGGTEAFF"</span>, <span class="st">"CAGLGGRDQETQYF"</span>,</span></span>
<span class="r-in"><span>              <span class="st">"CASSQETQYF"</span>, <span class="st">"CASSLTDTQYF"</span>,</span></span>
<span class="r-in"><span>              <span class="st">"CANYGYTF"</span>, <span class="st">"CANTGELFF"</span>,</span></span>
<span class="r-in"><span>              <span class="st">"CSANYGYTF"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  affix_probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">11</span>, nrow <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">toy_data</span><span class="op">$</span><span class="va">GroupID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"G1"</span>, <span class="st">"G2"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">atchley</span> <span class="op">&lt;-</span> <span class="fu">kmeansAtchley</span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">toy_data</span>,</span></span>
<span class="r-in"><span>  k <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>  amino_col <span class="op">=</span> <span class="st">"CloneSeq"</span>,</span></span>
<span class="r-in"><span>  sample_col <span class="op">=</span> <span class="st">"SampleID"</span>,</span></span>
<span class="r-in"><span>  group_col <span class="op">=</span> <span class="st">"GroupID"</span>,</span></span>
<span class="r-in"><span>  output_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  return_output <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Brian Neal, Hai Yang, Phi Long Le, Li Zhang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

