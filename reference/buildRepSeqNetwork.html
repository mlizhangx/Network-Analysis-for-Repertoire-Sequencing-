<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="
    Builds the network graph for an immune repertoire based on sequence
    similarity, computes specified network properties and generates customized
    visualizations."><title>
    Immune Repertoire Network By Sequence Similarity — buildRepSeqNetwork • NAIR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="
    Immune Repertoire Network By Sequence Similarity — buildRepSeqNetwork"><meta property="og:description" content="
    Builds the network graph for an immune repertoire based on sequence
    similarity, computes specified network properties and generates customized
    visualizations."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">NAIR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.9041</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/NAIR.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/associated_clusters.html">Searching for Associated TCR/BCR Clusters</a>
    <a class="dropdown-item" href="../articles/buildRepSeqNetwork.html">buildRepSeqNetwork</a>
    <a class="dropdown-item" href="../articles/dual_chain.html">Dual-Chain Network Analysis</a>
    <a class="dropdown-item" href="../articles/network_visualization.html">Network Visualization</a>
    <a class="dropdown-item" href="../articles/public_clusters.html">Searching for Public TCR/BCR Clusters</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1><!-- %%  ~~function to do ... ~~ -->
    Immune Repertoire Network By Sequence Similarity</h1>
      
      <div class="d-none name"><code>buildRepSeqNetwork.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><!-- %%  ~~ A concise (1-5 lines) description of what the function does. ~~ -->
    Builds the network graph for an immune repertoire based on sequence
    similarity, computes specified network properties and generates customized
    visualizations.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">buildRepSeqNetwork</span><span class="op">(</span></span>
<span></span>
<span>  <span class="co">## Input ##</span></span>
<span>  <span class="va">data</span>, <span class="va">seq_col</span>, count_col <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  subset_cols <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  min_seq_length <span class="op">=</span> <span class="fl">3</span>, drop_matches <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span></span>
<span>  <span class="co">## Network ##</span></span>
<span>  dist_type <span class="op">=</span> <span class="st">"hamming"</span>, dist_cutoff <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  drop_isolated_nodes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  node_stats <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  stats_to_include <span class="op">=</span> <span class="fu"><a href="chooseNodeStats.html">chooseNodeStats</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  cluster_stats <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cluster_fun <span class="op">=</span> <span class="va">cluster_fast_greedy</span>,</span>
<span></span>
<span>  <span class="co">## Visualization ##</span></span>
<span>  plots <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  print_plots <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot_title <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  plot_subtitle <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  color_nodes_by <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  <span class="va">...</span>,</span>
<span></span>
<span>  <span class="co">## Output ##</span></span>
<span>  output_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  output_type <span class="op">=</span> <span class="st">"individual"</span>,</span>
<span>  output_name <span class="op">=</span> <span class="st">"MyRepSeqNetwork"</span>,</span>
<span>  pdf_width <span class="op">=</span> <span class="fl">12</span>, pdf_height <span class="op">=</span> <span class="fl">10</span></span>
<span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p><!-- %%     ~~Describe \code{data} here~~ -->
    A data frame containing the immune repertoire sequencing data, with variables indexed by column and observations (e.g., clones or cells) indexed by row.</p></dd>

  <dt>seq_col</dt>
<dd><p><!-- %%     ~~Describe \code{seq_col} here~~ -->
    The column name or number of <code>data</code> containing the receptor sequences to be used as the basis of similarity between rows. Also accepts a vector of length 2 specifying distinct sequence columns (e.g., alpha, beta chains); then two rows are similar only if both types of sequences are similar.</p></dd>

  <dt>count_col</dt>
<dd><p><!-- %%     ~~Describe \code{count_col} here~~ -->
    Optional column name or number of <code>data</code> containing a measure of abundance, e.g., clone count. Passed to <code>getClusterStats</code>; only relevant if <code>cluster_stats = TRUE</code>.</p></dd>

  <dt>subset_cols</dt>
<dd><p><!-- %%     ~~Describe \code{other_cols} here~~ -->
    Optional vector of column names or numbers of <code>data</code>; if supplied, only these plus other relevant columns are included in the output. If <code>NULL</code> (the default), all columns of <code>data</code> are included.</p></dd>

  <dt>min_seq_length</dt>
<dd><p><!-- %%     ~~Describe \code{min_seq_length} here~~ -->
    A numeric scalar, or <code>NULL</code>. Observations whose receptor sequences have fewer than <code>min_seq_length</code> characters are removed prior to network analysis.</p></dd>

  <dt>drop_matches</dt>
<dd><p><!-- %%     ~~Describe \code{drop_chars} here~~ -->
    An optional regular expression or character string. Observations whose receptor sequences return a match are removed prior to network analysis.</p></dd>

  <dt>dist_type</dt>
<dd><p><!-- %%     ~~Describe \code{dist_type} here~~ -->
    The type of function to use as a measure of similarity between two receptor
    sequences. Valid options are <code>"hamming"</code> (the default), <code>"levenshtein"</code>
    and <code>"euclidean_on_atchley"</code> (only applicable to TCR CDR3 amino acid sequences).</p></dd>

  <dt>dist_cutoff</dt>
<dd><p><!-- %%     ~~Describe \code{dist_cutoff} here~~ -->
    A nonnegative scalar specifying the maximum distance threshold for
    similarity between receptor sequences.</p></dd>

  <dt>drop_isolated_nodes</dt>
<dd><p><!-- %%     ~~Describe \code{drop_isolated_nodes} here~~ -->
    A logical scalar; should observations whose receptor sequences are not
    similar to any other sequences be dropped from the network?</p></dd>

  <dt>node_stats</dt>
<dd><p><!-- %%     ~~Describe \code{node_stats} here~~ -->
    A logical scalar; should node-level network properties be computed?</p></dd>

  <dt>stats_to_include</dt>
<dd><p><!-- %%     ~~Describe \code{stats_to_include} here~~ -->
    A logical vector returned by <code><a href="chooseNodeStats.html">chooseNodeStats()</a></code>, specifying the node-level
    properties to include. Also accepts the values <code>"all"</code> and
    <code>"cluster_id_only"</code>. Only relevant if <code>node_stats = TRUE</code>.</p></dd>

  <dt>cluster_stats</dt>
<dd><p><!-- %%     ~~Describe \code{cluster_stats} here~~ -->
    A logical scalar; should cluster-level network properties be computed?</p></dd>

  <dt>cluster_fun</dt>
<dd><p><!-- %%     ~~Describe \code{net} here~~ -->
    Passed to <code>addClusterMembership</code>. Controls the algorithm used for cluster identification.</p></dd>

  <dt>plots</dt>
<dd><p>A logical scalar; should plot(s) of the network graph be generated?</p></dd>

  <dt>print_plots</dt>
<dd><p><!-- %%     ~~Describe \code{print_plots} here~~ -->
    A logical scalar; should visualizations be printed in the <code>R</code> plotting window?</p></dd>

  <dt>plot_title</dt>
<dd><p><!-- %%     ~~Describe \code{plot_title} here~~ -->
    A character string (or <code>NULL</code> value) to be used as the title in
    visualizations. The default value <code>"auto"</code> generates the title
    dynamically.</p></dd>

  <dt>plot_subtitle</dt>
<dd><p><!-- %%     ~~Describe \code{plot_subtitle} here~~ -->
    A character string (or <code>NULL</code> value) to be used as the subtitle in
    visualizations. The default value <code>"auto"</code> generates the title
    dynamically.</p></dd>

  <dt>color_nodes_by</dt>
<dd><p><!-- %%     ~~Describe \code{color_nodes_by} here~~ -->
    Optional. Column name or number of <code>data</code> used to color network nodes
    in visualizations. If a vector of values is supplied, one plot will be
    generated for each value. The value <code>"auto"</code> attempts to use one of several
    variables (e.g., cluster ID) to color the nodes, depending on what is available.</p></dd>

  <dt>...</dt>
<dd><p>Other arguments to <code>generateNetworkGraphPlots</code>.</p></dd>

  <dt>output_dir</dt>
<dd><p><!-- %%     ~~Describe \code{output_dir} here~~ -->
  The output directory; if <code>NULL</code>, output will not be written to file.</p></dd>

  <dt>output_type</dt>
<dd><p><!-- %%     ~~Describe \code{output_dir} here~~ -->
  A character string specifying the file format to use when writing output to file. Default <code>"individual"</code> saves each item as a separate, uncompressed file, with data frames saved in csv format. <code>"rda"</code> and <code>"rds"</code> save the output list as a rda and rds file, respectively. For all output types, any plots generated will also be saved in a pdf file.</p></dd>

  <dt>output_name</dt>
<dd><p><!-- %%     ~~Describe \code{output_dir} here~~ -->
  A character string to be used as a common filename prefix for any files saved.</p></dd>

  <dt>pdf_width</dt>
<dd><p><!-- %%     ~~Describe \code{plot_width} here~~ -->
    Passed to the <code>width</code> argument of <code><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">grDevices::pdf()</a></code>.</p></dd>

  <dt>pdf_height</dt>
<dd><p><!-- %%     ~~Describe \code{plot_height} here~~ -->
    Passed to the <code>height</code> argument of <code><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">grDevices::pdf()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><!-- %%  ~~ If necessary, more details than the description above ~~ -->
    To build the immune repertoire network, each TCR/BCR clone (bulk data) or
    cell (single-cell data) is modeled as a network node (corresponding to a single
    row of the input data). Two nodes are considered adjacent (share an edge) if
    their receptor sequences are sufficiently similar.</p>
<p>Both nucleotide and amino acid sequences are supported. Sequence similarity is
    based on either the Hamming distance or Levenshtein (edit) distance. For TCR CDR3
    amino acid sequences, an alternative measure of similarity is also available via
    the argument <code>dist_type = "euclidean_on_atchley"</code>; this represents sequences as
    30-dimensional numeric vectors according to the Atchley factors of their amino acids
    (which encode biological properties) using a trained encoder. Similarity is then based on the
    Euclidean distance between these representations. Selecting a distance
    threshold is challenging in this setting, however, as particular values lack
    the clear interpretations enjoyed by the Hamming and Levenshtein distances.</p>
<p>The graph adjacency matrix for the network is computed and used to generate
    a <code>igraph</code> network object. Network properties are computed largely
    through the use of <code>igraph</code> functions. The visualizations are generated with
    <code>ggraph</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p><!-- %%  ~Describe the value returned --></p>


<p><!-- %%  If it is a LIST, use --></p>


<p><!-- %%  \item{comp1 }{Description of 'comp1'} --></p>


<p><!-- %%  \item{comp2 }{Description of 'comp2'} --></p>


<p><!-- %% ... --></p>


<p>If the constructed network contains no edges, the function will return <code>NULL</code> with a warning. Otherwise, the function invisibly returns a list containing some or all of the following items:</p>
<dl><dt>igraph</dt>
<dd><p>An <code>igraph</code> object containing the edge list for the network.</p></dd>

    <dt>adjacency_matrix</dt>
<dd><p>The network graph adjacency matrix, stored as a sparse matrix of class <code>dgCMatrix</code> from the <code>Matrix</code> package.</p></dd>

    <dt>node_data</dt>
<dd><p>A data
    frame containing the node-level meta-data for the network. This data frame contains
    all column names of <code>data</code> unless <code>subset_cols</code> is non-null, in which
    case only the column names of <code>data</code> specified by <code>subset_cols</code>, along
    with other relevant ones (e.g., <code>seq_col</code>), will be present in the returned
    data frame. The data frame will additionally contain columns for any node-level
    network properties computed (as specified through the <code>node_stats</code> and
    <code>stats_to_include</code> arguments). The data frame will contain one row for
    each node that remains in the network after all filtering has occurred,
    including any filtering based on <code>drop_isolated_nodes</code>. The row names
    of the original input data will be preserved.</p></dd>

    <dt>cluster_data</dt>
<dd><p>A data frame containing the cluster-level properties, with one row per cluster. Only included if <code>cluster_stats = TRUE</code>.</p></dd>

    <dt>plots</dt>
<dd><p>A list containing the graph plot(s) as <code>ggraph</code> objects. Only included if <code>plots = TRUE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Hai Yang, Jason Cham, Brian Neal, Zenghua Fan, Tao He and Li Zhang. (2023). NAIR: Network Analysis of Immune Repertoire. <em>Frontiers in Immunology</em>, vol. 14. https://doi.org/10.3389/fimmu.2023.1181825</p>
<p><a href="https://www.frontiersin.org/articles/10.3389/fimmu.2023.1181825" class="external-link">https://www.frontiersin.org/articles/10.3389/fimmu.2023.1181825</a></p>
<p><a href="https://github.com/mlizhangx/Network-Analysis-for-Repertoire-Sequencing-" class="external-link">https://github.com/mlizhangx/Network-Analysis-for-Repertoire-Sequencing-</a></p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p><!-- %%  ~~who you are~~ -->
    Brian Neal (<a href="mailto:Brian.Neal@ucsf.edu">Brian.Neal@ucsf.edu</a>)</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simulate some toy data for demonstration</span></span></span>
<span class="r-in"><span><span class="va">toy_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="simulateToyData.html">simulateToyData</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">network</span> <span class="op">&lt;-</span> <span class="fu">buildRepSeqNetwork</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">toy_data</span>, seq_col <span class="op">=</span> <span class="st">"CloneSeq"</span>,</span></span>
<span class="r-in"><span>  node_stats <span class="op">=</span> <span class="cn">TRUE</span>, cluster_stats <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  color_nodes_by <span class="op">=</span> <span class="st">"transitivity"</span>, color_scheme <span class="op">=</span> <span class="st">"plasma-1"</span>,</span></span>
<span class="r-in"><span>  size_nodes_by <span class="op">=</span> <span class="st">"degree"</span>, node_size_limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1.5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  output_dir <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Brian Neal, Hai Yang, Phi Long Le, Li Zhang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

