<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="NAIR">
<title>Cluster Analysis • NAIR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Cluster Analysis">
<meta property="og:description" content="NAIR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">NAIR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/NAIR.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/buildRepSeqNetwork.html">buildRepSeqNetwork()/buildNet()</a>
    <a class="dropdown-item" href="../articles/node_properties.html">Node-Level Network Properties</a>
    <a class="dropdown-item" href="../articles/cluster_analysis.html">Cluster Analysis</a>
    <a class="dropdown-item" href="../articles/network_visualization.html">Network Visualization</a>
    <a class="dropdown-item" href="../articles/supplementary.html">Supplementary Functions</a>
    <a class="dropdown-item" href="../articles/dual_chain.html">Dual-Chain Network Analysis</a>
    <a class="dropdown-item" href="../articles/associated_clusters.html">Searching for Associated TCR/BCR Clusters</a>
    <a class="dropdown-item" href="../articles/public_clusters.html">Searching for Public TCR/BCR Clusters</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mlizhangx/Network-Analysis-for-Repertoire-Sequencing-/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Cluster Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mlizhangx/Network-Analysis-for-Repertoire-Sequencing-/blob/HEAD/vignettes/cluster_analysis.Rmd" class="external-link"><code>vignettes/cluster_analysis.Rmd</code></a></small>
      <div class="d-none name"><code>cluster_analysis.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Cluster analysis involves using a community-finding algorithm to
partition the network graph into clusters (densely-connected subgraphs).
These clusters represent groups of clones/cells with similar receptor
sequences.</p>
<p>Cluster analysis can be performed when calling
<code><a href="../reference/buildRepSeqNetwork.html">buildRepSeqNetwork()</a></code> by setting
<code>cluster_stats = TRUE</code> or as a separate step using
<code><a href="../reference/addClusterStats.html">addClusterStats()</a></code>.</p>
<p>When performing cluster analysis, each cluster is assigned a numeric
cluster ID, and the cluster membership of each node is recorded as a
variable in the node metadata. Properties are computed for each cluster,
such as total node count, mean sequence length, the sequence with the
greatest network degree, and various centrality indices of the cluster’s
graph. The cluster metadata for these properties is included as its own
data frame contained in the list of network objects.</p>
<div class="section level3">
<h3 id="simulate-data-for-demonstration">Simulate Data for Demonstration<a class="anchor" aria-label="anchor" href="#simulate-data-for-demonstration"></a>
</h3>
<p>We simulate some toy data for demonstration.</p>
<p>We simulate data consisting of two samples with 100 observations
each, for a total of 200 observations (rows).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/">NAIR</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Welcome to NAIR: Network Analysis of Immune Repertoire.</span></span>
<span><span class="co">#&gt; Get started using `vignette("NAIR")`, or by visiting</span></span>
<span><span class="co">#&gt; https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/</span></span>
<span><span class="va">dir_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">toy_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulateToyData.html">simulateToyData</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">toy_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;        CloneSeq CloneFrequency CloneCount SampleID</span></span>
<span><span class="co">#&gt; 1 TTGAGGAAATTCG    0.007873775       3095  Sample1</span></span>
<span><span class="co">#&gt; 2 GGAGATGAATCGG    0.007777102       3057  Sample1</span></span>
<span><span class="co">#&gt; 3 GTCGGGTAATTGG    0.009094910       3575  Sample1</span></span>
<span><span class="co">#&gt; 4 GCCGGGTAATTCG    0.010160859       3994  Sample1</span></span>
<span><span class="co">#&gt; 5 GAAAGAGAATTCG    0.009336593       3670  Sample1</span></span>
<span><span class="co">#&gt; 6 AGGTGGGAATTCG    0.010369470       4076  Sample1</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">toy_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 200</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="performing-cluster-analysis">Performing Cluster Analysis<a class="anchor" aria-label="anchor" href="#performing-cluster-analysis"></a>
</h2>
<div class="section level3">
<h3 id="with-buildrepseqnetworkbuildnet">With <code>buildRepSeqNetwork()</code>/<code>buildNet()</code><a class="anchor" aria-label="anchor" href="#with-buildrepseqnetworkbuildnet"></a>
</h3>
<p>Calling <code><a href="../reference/buildRepSeqNetwork.html">buildRepSeqNetwork()</a></code> or its alias
<code><a href="../reference/buildRepSeqNetwork.html">buildNet()</a></code> with <code>cluster_stats = TRUE</code> is one
way to perform cluster analysis.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildRepSeqNetwork.html">buildRepSeqNetwork</a></span><span class="op">(</span><span class="va">toy_data</span>, <span class="st">"CloneSeq"</span>, cluster_stats <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="with-addclusterstats">With <code>addClusterStats()</code><a class="anchor" aria-label="anchor" href="#with-addclusterstats"></a>
</h3>
<p><code><a href="../reference/addClusterStats.html">addClusterStats()</a></code> can be used with the output of
<code><a href="../reference/buildRepSeqNetwork.html">buildRepSeqNetwork()</a></code> to perform cluster analysis.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildRepSeqNetwork.html">buildNet</a></span><span class="op">(</span><span class="va">toy_data</span>, <span class="st">"CloneSeq"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addClusterStats.html">addClusterStats</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h2>
<div class="section level3">
<h3 id="cluster-membership">Cluster Membership<a class="anchor" aria-label="anchor" href="#cluster-membership"></a>
</h3>
<p>After using either of the methods described above, the node metadata
now contains a variable <code>cluster_id</code> with the values for
cluster membership:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">net</span><span class="op">$</span><span class="va">node_data</span><span class="op">$</span><span class="va">cluster_id</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 20 3  4  2  2  4 </span></span>
<span><span class="co">#&gt; Levels: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="cluster-properties">Cluster Properties<a class="anchor" aria-label="anchor" href="#cluster-properties"></a>
</h3>
<p>The output list now includes an additional data frame
<code>cluster_data</code> containing the cluster metadata:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "details"          "igraph"           "adjacency_matrix" "node_data"       </span></span>
<span><span class="co">#&gt; [5] "cluster_data"     "plots"</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">net</span><span class="op">$</span><span class="va">cluster_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 20</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">net</span><span class="op">$</span><span class="va">cluster_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "cluster_id"                  "node_count"                 </span></span>
<span><span class="co">#&gt;  [3] "mean_seq_length"             "mean_degree"                </span></span>
<span><span class="co">#&gt;  [5] "max_degree"                  "seq_w_max_degree"           </span></span>
<span><span class="co">#&gt;  [7] "agg_count"                   "max_count"                  </span></span>
<span><span class="co">#&gt;  [9] "seq_w_max_count"             "diameter_length"            </span></span>
<span><span class="co">#&gt; [11] "global_transitivity"         "assortativity"              </span></span>
<span><span class="co">#&gt; [13] "edge_density"                "degree_centrality_index"    </span></span>
<span><span class="co">#&gt; [15] "closeness_centrality_index"  "eigen_centrality_index"     </span></span>
<span><span class="co">#&gt; [17] "eigen_centrality_eigenvalue"</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">net</span><span class="op">$</span><span class="va">cluster_data</span><span class="op">[</span> , <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;   cluster_id node_count mean_seq_length mean_degree max_degree seq_w_max_degree</span></span>
<span><span class="co">#&gt; 1          1         14           13.00        3.36          9    AAAAAAAAATTGC</span></span>
<span><span class="co">#&gt; 2          2         28           12.96        8.43         18    GGGGGGGAATTGG</span></span>
<span><span class="co">#&gt; 3          3          9           12.67        2.22          4     AGAAGAAAATTC</span></span>
<span><span class="co">#&gt; 4          4          6           13.00        3.33          9    GGGGGGAAATTGG</span></span>
<span><span class="co">#&gt; 5          5          6           12.00        2.17          3     AGGGAGGAATTC</span></span>
<span><span class="co">#&gt; 6          6         25           12.00        4.60         10     AAAAAAAAATTG</span></span></code></pre></div>
<p>A brief description of each cluster-level property is given
below:</p>
<ul>
<li>
<code>node_count</code>: The number of nodes in the cluster.</li>
<li>
<code>mean_seq_length</code>: The mean sequence length in the
cluster.</li>
<li>
<code>mean_degree</code>: The mean network degree in the
cluster.</li>
<li>
<code>max_degree</code>: The maximum network degree in the
cluster.</li>
<li>
<code>seq_w_max_degree</code>: The receptor sequence possessing the
maximum degree within the cluster.</li>
<li>
<code>agg_count</code>: The aggregate count among all nodes in the
cluster (based on the counts in <code>count_col</code>, if
provided).</li>
<li>
<code>max_count</code>: The maximum count among all nodes in the
cluster (based on the counts in <code>count_col</code>, if
provided).</li>
<li>
<code>seq_w_max_count</code>: The receptor sequence possessing the
maximum count within the cluster.</li>
<li>
<code>diameter_length</code>: The longest geodesic distance in the
cluster.</li>
<li>
<code>assortativity</code>: The assortativity coefficient of the
cluster’s graph, based on the degree (minus one) of each node in the
cluster (with the degree computed based only upon the nodes within the
cluster).</li>
<li>
<code>global_transitivity</code>: The transitivity (i.e., clustering
coefficient) for the cluster’s graph, which estimates the probability
that adjacent vertices are connected.</li>
<li>
<code>edge_density</code>: The number of edges in the cluster as a
fraction of the maximum possible number of edges.</li>
<li>
<code>degree_centrality_index</code>: The cluster-level centrality
index based on degree within the cluster graph.</li>
<li>
<code>closeness_centrality_index</code>: The cluster-level
centrality index based on closeness, i.e., distance to other nodes in
the cluster.</li>
<li>
<code>eigen_centrality_index</code>: The cluster-level centrality
index based on the eigenvector centrality scores, i.e., values of the
principal eigenvector of the adjacency matrix for the cluster.</li>
<li>
<code>eigen_centrality_eigenvalue</code>: The eigenvalue
corresponding to the principal eigenvector of the adjacency matrix for
the cluster.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="abundance-based-properties">
<a name="count_col"></a> Abundance-Based Properties<a class="anchor" aria-label="anchor" href="#abundance-based-properties"></a>
</h2>
<p>Some cluster-level network properties, such as <code>agg_count</code>
and <code>max_count</code>, are only computed if the user specifies a
column of the input data containing a measure of abundance for each row
(e.g., clone count for bulk data or Unique Molecular Identifier count
for single-cell data). This column is specified using the
<code>count_col</code> function, which accepts a column name or column
index.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildRepSeqNetwork.html">buildNet</a></span><span class="op">(</span><span class="va">toy_data</span>, <span class="st">"CloneSeq"</span>, </span>
<span>                cluster_stats <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                count_col <span class="op">=</span> <span class="st">"CloneCount"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>or:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildRepSeqNetwork.html">buildNet</a></span><span class="op">(</span><span class="va">toy_data</span>, <span class="st">"CloneSeq"</span><span class="op">)</span></span>
<span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addClusterStats.html">addClusterStats</a></span><span class="op">(</span><span class="va">net</span>, count_col <span class="op">=</span> <span class="st">"CloneCount"</span><span class="op">)</span></span></code></pre></div>
<p>In case the data includes more than one count variable,
<code>net$details$count_col_for_cluster_data</code> specifies which of
these variables corresponds to the count-based cluster properties:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span><span class="op">$</span><span class="va">details</span><span class="op">$</span><span class="va">count_col_for_cluster_data</span></span>
<span><span class="co">#&gt; [1] "CloneCount"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="clustering-algorithm">
<a name="cluster_alg"></a> Clustering Algorithm<a class="anchor" aria-label="anchor" href="#clustering-algorithm"></a>
</h2>
<p>By default, clustering is performed using
<code><a href="https://r.igraph.org/reference/cluster_fast_greedy.html" class="external-link">igraph::cluster_fast_greedy()</a></code>. Other clustering algorithms
can be used instead of the default algorithm. In
<code><a href="../reference/buildRepSeqNetwork.html">buildRepSeqNetwork()</a></code> and <code><a href="../reference/addClusterStats.html">addClusterStats()</a></code>,
the algorithm is specified using the <code>cluster_fun</code> parameter,
which accepts one of the following values:</p>
<ul>
<li>
<code>"fast_greedy"</code> (default)</li>
<li><code>"edge_betweenness"</code></li>
<li><code>"infomap"</code></li>
<li><code>"label_prop"</code></li>
<li><code>"leading_eigen"</code></li>
<li><code>"leiden"</code></li>
<li><code>"louvain"</code></li>
<li><code>"optimal"</code></li>
<li><code>"spinglass"</code></li>
<li><code>"walktrap"</code></li>
</ul>
<p>For details on the clustering algorithms, see
<code>?addClusterMembership()</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildRepSeqNetwork.html">buildRepSeqNetwork</a></span><span class="op">(</span><span class="va">toy_data</span>, <span class="st">"CloneSeq"</span>, </span>
<span>                          cluster_stats <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                          cluster_fun <span class="op">=</span> <span class="st">"leiden"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>It is possible when using <code><a href="../reference/addClusterStats.html">addClusterStats()</a></code> to specify
non-default argument values for optional parameters of the clustering
functions.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildRepSeqNetwork.html">buildRepSeqNetwork</a></span><span class="op">(</span><span class="va">toy_data</span>, <span class="st">"CloneSeq"</span><span class="op">)</span></span>
<span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addClusterStats.html">addClusterStats</a></span><span class="op">(</span><span class="va">net</span>, </span>
<span>                       cluster_fun <span class="op">=</span> <span class="st">"leiden"</span>,</span>
<span>                       beta <span class="op">=</span> <span class="fl">0.02</span>,</span>
<span>                       n_iterations <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="cluster-membership-only">Cluster Membership Only<a class="anchor" aria-label="anchor" href="#cluster-membership-only"></a>
</h2>
<p><code><a href="../reference/addClusterMembership.html">addClusterMembership()</a></code> is similar to
<code><a href="../reference/addClusterStats.html">addClusterStats()</a></code>, but only adds cluster membership values
to the node metadata. It does not compute cluster properties.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildRepSeqNetwork.html">buildRepSeqNetwork</a></span><span class="op">(</span><span class="va">toy_data</span>, <span class="st">"CloneSeq"</span><span class="op">)</span></span>
<span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addClusterMembership.html">addClusterMembership</a></span><span class="op">(</span><span class="va">net</span>, </span>
<span>                            cluster_fun <span class="op">=</span> <span class="st">"leiden"</span>,</span>
<span>                            beta <span class="op">=</span> <span class="fl">0.02</span>,</span>
<span>                            n_iterations <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="multiple-instances-of-clustering">Multiple Instances of Clustering<a class="anchor" aria-label="anchor" href="#multiple-instances-of-clustering"></a>
</h2>
<p>Using <code><a href="../reference/addClusterMembership.html">addClusterMembership()</a></code> or
<code><a href="../reference/addClusterStats.html">addClusterStats()</a></code>, it is possible to perform cluster
analysis with different clustering algorithms and record the cluster
membership from each instance of clustering.</p>
<p>When performing cluster analysis, the <code>cluster_id_name</code>
parameter specifies the name of the cluster membership variable added to
the node metadata. This allows the cluster membership values from each
instance of clustering to be saved under a different variable name.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First instance of clustering</span></span>
<span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildRepSeqNetwork.html">buildRepSeqNetwork</a></span><span class="op">(</span><span class="va">toy_data</span>, <span class="st">"CloneSeq"</span>, </span>
<span>                          print_plots <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                          cluster_stats <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                          cluster_id_name <span class="op">=</span> <span class="st">"cluster_greedy"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Second instance of clustering</span></span>
<span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addClusterMembership.html">addClusterMembership</a></span><span class="op">(</span><span class="va">net</span>,</span>
<span>                            cluster_fun <span class="op">=</span> <span class="st">"louvain"</span>,</span>
<span>                            cluster_id_name <span class="op">=</span> <span class="st">"cluster_louvain"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addPlots.html">addPlots</a></span><span class="op">(</span><span class="va">net</span>,</span>
<span>                color_nodes_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cluster_greedy"</span>, <span class="st">"cluster_louvain"</span><span class="op">)</span>,</span>
<span>                color_scheme <span class="op">=</span> <span class="st">"Viridis"</span>,</span>
<span>                size_nodes_by <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>                print_plots <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="cluster_analysis_files/figure-html/unnamed-chunk-17-1.png" width="100%" style="display: block; margin: auto;"><img src="cluster_analysis_files/figure-html/unnamed-chunk-17-2.png" width="100%" style="display: block; margin: auto;"></p>
<p>Currently, keeping cluster properties from multiple instances of
clustering analysis is not supported. <code><a href="../reference/addClusterStats.html">addClusterStats()</a></code> can
overwrite existing cluster properties using
<code>overwrite = TRUE</code>.</p>
<p>The <code>details</code> element of the network list helps with
keeping track of clustering results and cross-referencing the cluster
properties with the node properties.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span><span class="op">$</span><span class="va">details</span></span>
<span><span class="co">#&gt; $seq_col</span></span>
<span><span class="co">#&gt; [1] "CloneSeq"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $dist_type</span></span>
<span><span class="co">#&gt; [1] "hamming"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $dist_cutoff</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $drop_isolated_nodes</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $nodes_in_network</span></span>
<span><span class="co">#&gt; [1] 122</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $clusters_in_network</span></span>
<span><span class="co">#&gt; fast_greedy     louvain </span></span>
<span><span class="co">#&gt;          20          20 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $cluster_id_variable</span></span>
<span><span class="co">#&gt;       fast_greedy           louvain </span></span>
<span><span class="co">#&gt;  "cluster_greedy" "cluster_louvain" </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $cluster_data_goes_with</span></span>
<span><span class="co">#&gt; [1] "cluster_greedy"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $count_col_for_cluster_data</span></span>
<span><span class="co">#&gt; [1] NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $min_seq_length</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $drop_matches</span></span>
<span><span class="co">#&gt; [1] "NULL"</span></span></code></pre></div>
<p><code>net$details$cluster_id_variable</code> tells which cluster
membership variable corresponds to which clustering algorithm.</p>
<p><code>net$details$cluster_data_goes_with</code> tells which cluster
membership variable corresponds to the cluster metadata.</p>
</div>
<div class="section level2">
<h2 id="labeling-clusters">Labeling Clusters<a class="anchor" aria-label="anchor" href="#labeling-clusters"></a>
</h2>
<p>To more easily reference the clusters within a visual plot, clusters
can be labeled with their cluster IDs using
<code><a href="../reference/addClusterLabels.html">labelClusters()</a></code>.</p>
<p>The list of network objects returned by
<code><a href="../reference/buildRepSeqNetwork.html">buildRepSeqNetwork()</a></code> is passed to the <code>net</code>
parameter. By default, all plots contained in the list
<code>net$plots</code> will be annotated, but a subset of plots may be
specified as a vector of the element names or positions to the
<code>plots</code> parameter.</p>
<p>The name of the cluster membership variable in the node metadata is
provided to the <code>cluster_id_col</code> parameter (the default is
<code>"cluster_id"</code>).</p>
<p>By default, only the 20 largest clusters by node count are labeled in
order to preserve legibility. This number can be changed using the
<code>top_n_clusters</code> parameter.</p>
<p>Instead of ranking clusters by node count, a different criterion can
be used, provided the list <code>net</code> contains cluster properties
corresponding to the cluster membership variable. The name of a numeric
cluster property is provided to the <code>criterion</code> parameter.
The ranking order can be reversed using
<code>greatest_values = FALSE</code>.</p>
<p>The size of the cluster ID labels can be adjusted by providing a
numeric value to the <code>size</code> parameter (the default is 5), and
their color can be changed by providing a valid character string to the
<code>color</code> parameter.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First instance of clustering</span></span>
<span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildRepSeqNetwork.html">buildNet</a></span><span class="op">(</span><span class="va">toy_data</span>, <span class="st">"CloneSeq"</span>, </span>
<span>                print_plots <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                cluster_stats <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                cluster_id_name <span class="op">=</span> <span class="st">"cluster_greedy"</span>,</span>
<span>                color_nodes_by <span class="op">=</span> <span class="st">"cluster_greedy"</span>,</span>
<span>                color_scheme <span class="op">=</span> <span class="st">"Viridis"</span>,</span>
<span>                size_nodes_by <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>                plot_title <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Second instance of clustering</span></span>
<span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addClusterMembership.html">addClusterMembership</a></span><span class="op">(</span><span class="va">net</span>,</span>
<span>                            cluster_fun <span class="op">=</span> <span class="st">"louvain"</span>,</span>
<span>                            cluster_id_name <span class="op">=</span> <span class="st">"cluster_louvain"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addPlots.html">addPlots</a></span><span class="op">(</span><span class="va">net</span>,</span>
<span>                color_nodes_by <span class="op">=</span> <span class="st">"cluster_louvain"</span>,</span>
<span>                color_scheme <span class="op">=</span> <span class="st">"Viridis"</span>,</span>
<span>                size_nodes_by <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>                print_plots <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Label the clusters in each plot</span></span>
<span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addClusterLabels.html">labelClusters</a></span><span class="op">(</span><span class="va">net</span>,</span>
<span>                     plots <span class="op">=</span> <span class="st">"cluster_greedy"</span>,</span>
<span>                     cluster_id_col <span class="op">=</span> <span class="st">"cluster_greedy"</span>,</span>
<span>                     top_n_clusters <span class="op">=</span> <span class="fl">7</span>,</span>
<span>                     size <span class="op">=</span> <span class="fl">7</span></span>
<span><span class="op">)</span></span>
<span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addClusterLabels.html">labelClusters</a></span><span class="op">(</span><span class="va">net</span>,</span>
<span>                     plots <span class="op">=</span> <span class="st">"cluster_louvain"</span>,</span>
<span>                     cluster_id_col <span class="op">=</span> <span class="st">"cluster_louvain"</span>,</span>
<span>                     top_n_clusters <span class="op">=</span> <span class="fl">7</span>,</span>
<span>                     size <span class="op">=</span> <span class="fl">7</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">net</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">cluster_greedy</span></span>
<span><span class="co">#&gt; Warning: Removed 115 rows containing missing values (`geom_text()`).</span></span></code></pre></div>
<p><img src="cluster_analysis_files/figure-html/unnamed-chunk-19-1.png" width="100%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">cluster_louvain</span></span>
<span><span class="co">#&gt; Warning: Removed 115 rows containing missing values (`geom_text()`).</span></span></code></pre></div>
<p><img src="cluster_analysis_files/figure-html/unnamed-chunk-19-2.png" width="100%" style="display: block; margin: auto;"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Brian Neal, Hai Yang, Phi Long Le, Li Zhang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
