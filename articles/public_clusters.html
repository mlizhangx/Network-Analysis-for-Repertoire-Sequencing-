<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="NAIR">
<title>Searching for Public TCR/BCR Clusters • NAIR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Searching for Public TCR/BCR Clusters">
<meta property="og:description" content="NAIR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">NAIR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/NAIR.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/buildRepSeqNetwork.html">buildRepSeqNetwork()/buildNet()</a>
    <a class="dropdown-item" href="../articles/node_properties.html">Node-Level Network Properties</a>
    <a class="dropdown-item" href="../articles/cluster_analysis.html">Cluster Analysis</a>
    <a class="dropdown-item" href="../articles/network_visualization.html">Network Visualization</a>
    <a class="dropdown-item" href="../articles/supplementary.html">Supplementary Functions</a>
    <a class="dropdown-item" href="../articles/dual_chain.html">Dual-Chain Network Analysis</a>
    <a class="dropdown-item" href="../articles/associated_clusters.html">Searching for Associated TCR/BCR Clusters</a>
    <a class="dropdown-item" href="../articles/public_clusters.html">Searching for Public TCR/BCR Clusters</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mlizhangx/Network-Analysis-for-Repertoire-Sequencing-/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Searching for Public TCR/BCR Clusters</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mlizhangx/Network-Analysis-for-Repertoire-Sequencing-/blob/HEAD/vignettes/public_clusters.Rmd" class="external-link"><code>vignettes/public_clusters.Rmd</code></a></small>
      <div class="d-none name"><code>public_clusters.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>NAIR</code> package includes a set of functions that
facilitate searching for public TCR/BCR clusters across multiple samples
of Adaptive Immune Receptor Repertoire Sequencing (AIRR-Seq) data.</p>
<p>In this context, a public cluster consists of similar TCR/BCR clones
(e.g., those whose CDR3 amino acid sequences differ by at most one amino
acid) that are shared across samples (e.g., across individuals or across
time points for a single individual).</p>
<div class="section level5">
<h5 id="overview-of-process">Overview of Process<a class="anchor" aria-label="anchor" href="#overview-of-process"></a>
</h5>
<ol style="list-style-type: decimal">
<li>
<a href="#step1"><strong>Identify prominent clusters within each
sample.</strong></a>. For each sample, construct the repertoire network
and use cluster analysis to partition the network into clusters. From
each sample, select clusters based on node count and clone count.</li>
<li>
<a href="#step2"><strong>Construct global network using the selected
clusters.</strong></a> Combine the selected data from step 1 into a
single global network. Use cluster analysis to partition the global
network into clusters, which are considered as the public clusters.</li>
<li>
<a href="#step3">Perform additional tasks</a> such as labeling the
global clusters in the visual plot and analyzing individual clusters of
interest.</li>
</ol>
</div>
<div class="section level5">
<h5 id="simulate-data-for-demonstration">Simulate Data for Demonstration<a class="anchor" aria-label="anchor" href="#simulate-data-for-demonstration"></a>
</h5>
<p>We simulate some toy data for demonstration.</p>
<p>Our toy data includes 30 samples, each containing 30
observations.</p>
<p>Some sequences are simulated with a tendency to appear in relatively
few samples, while others are simulated with a tendency to appear in
many samples.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/">NAIR</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Welcome to NAIR: Network Analysis of Immune Repertoire.</span></span>
<span><span class="co">#&gt; Get started using `vignette("NAIR")`, or by visiting</span></span>
<span><span class="co">#&gt; https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/</span></span>
<span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">dir_input_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"input_samples"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">dir_input_samples</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span><span class="va">sample_size</span> <span class="op">&lt;-</span> <span class="fl">30</span> <span class="co"># (seqs per sample)          </span></span>
<span><span class="va">base_seqs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"CASSIEGQLSTDTQYF"</span>, <span class="st">"CASSEEGQLSTDTQYF"</span>, <span class="st">"CASSSVETQYF"</span>,</span>
<span>  <span class="st">"CASSPEGQLSTDTQYF"</span>, <span class="st">"RASSLAGNTEAFF"</span>, <span class="st">"CASSHRGTDTQYF"</span>, <span class="st">"CASDAGVFQPQHF"</span>,</span>
<span>  <span class="st">"CASSLTSGYNEQFF"</span>, <span class="st">"CASSETGYNEQFF"</span>, <span class="st">"CASSLTGGNEQFF"</span>, <span class="st">"CASSYLTGYNEQFF"</span>,</span>
<span>  <span class="st">"CASSLTGNEQFF"</span>, <span class="st">"CASSLNGYNEQFF"</span>, <span class="st">"CASSFPWDGYGYTF"</span>, <span class="st">"CASTLARQGGELFF"</span>,</span>
<span>  <span class="st">"CASTLSRQGGELFF"</span>, <span class="st">"CSVELLPTGPLETSYNEQFF"</span>, <span class="st">"CSVELLPTGPSETSYNEQFF"</span>,</span>
<span>  <span class="st">"CVELLPTGPSETSYNEQFF"</span>, <span class="st">"CASLAGGRTQETQYF"</span>, <span class="st">"CASRLAGGRTQETQYF"</span>,</span>
<span>  <span class="st">"CASSLAGGRTETQYF"</span>, <span class="st">"CASSLAGGRTQETQYF"</span>, <span class="st">"CASSRLAGGRTQETQYF"</span>,</span>
<span>  <span class="st">"CASQYGGGNQPQHF"</span>, <span class="st">"CASSLGGGNQPQHF"</span>, <span class="st">"CASSNGGGNQPQHF"</span>, <span class="st">"CASSYGGGGNQPQHF"</span>,</span>
<span>  <span class="st">"CASSYGGGQPQHF"</span>, <span class="st">"CASSYKGGNQPQHF"</span>, <span class="st">"CASSYTGGGNQPQHF"</span>, </span>
<span>  <span class="st">"CAWSSQETQYF"</span>, <span class="st">"CASSSPETQYF"</span>, <span class="st">"CASSGAYEQYF"</span>, <span class="st">"CSVDLGKGNNEQFF"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># relative generation probabilities</span></span>
<span><span class="va">pgen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/toeplitz.html" class="external-link">toeplitz</a></span><span class="op">(</span><span class="fl">0.6</span><span class="op">^</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">sample_size</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, nrow <span class="op">=</span> <span class="va">samples</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">base_seqs</span><span class="op">)</span> <span class="op">-</span> <span class="va">samples</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/simulateToyData.html">simulateToyData</a></span><span class="op">(</span>    </span>
<span>  samples <span class="op">=</span> <span class="va">samples</span>, </span>
<span>  sample_size <span class="op">=</span> <span class="va">sample_size</span>,</span>
<span>  prefix_length <span class="op">=</span> <span class="fl">1</span>, </span>
<span>  prefix_chars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">""</span><span class="op">)</span>,</span>
<span>  prefix_probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">samples</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">samples</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  affixes <span class="op">=</span> <span class="va">base_seqs</span>, </span>
<span>  affix_probs <span class="op">=</span> <span class="va">pgen</span>, </span>
<span>  num_edits <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="va">dir_input_samples</span>, </span>
<span>  no_return <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Each sample’s data frame is saved to its own file using the RDS file
format. The files are named “<code>Sample1.rds</code>”,
“<code>Sample2.rds</code>”, etc. A character string containing the
directory path is assigned to the R environment variable
<code>dir_input_samples</code> for later reference.</p>
<p>The first few rows of the data for the first sample appear as
follows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View first few rows of data for sample 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_input_samples</span>, <span class="st">"Sample1.rds"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;           CloneSeq CloneFrequency CloneCount SampleID</span></span>
<span><span class="co">#&gt; 1 CASSIEGQLSTDTQYF     0.02606559       2832  Sample1</span></span>
<span><span class="co">#&gt; 2 CASSEEGQLSTDTQYF     0.03718396       4040  Sample1</span></span>
<span><span class="co">#&gt; 3      CASSSPETQYF     0.03182726       3458  Sample1</span></span>
<span><span class="co">#&gt; 4 CASSIEGQLSTDTQYF     0.04615781       5015  Sample1</span></span>
<span><span class="co">#&gt; 5      CAWSSQETQYF     0.06006498       6526  Sample1</span></span>
<span><span class="co">#&gt; 6 CASSEEGQLSTDTQYF     0.03363123       3654  Sample1</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 class="tabset" id="step-1-identify-prominent-clusters-within-each-sample">
<a name="step1"></a> Step 1: Identify Prominent
Clusters Within Each Sample<a class="anchor" aria-label="anchor" href="#step-1-identify-prominent-clusters-within-each-sample"></a>
</h2>
<p>First, we use <code><a href="../reference/findPublicClusters.html">findPublicClusters()</a></code> to search across
samples and select clones for inclusion in the global network.</p>
<p>Each sample’s repertoire network is constructed individually, and
cluster analysis is used to partition each network into clusters. The
clusters are then filtered according to node count and clone count based
on user-specified criteria. The AIRR-Seq data for the clusters that
remain after filtering is saved to files to be used as inputs for <a href="#step2">step 2</a>.</p>
<p>Below, we explain how to use <code><a href="../reference/findPublicClusters.html">findPublicClusters()</a></code>.</p>
<div class="section level3">
<h3 class="tabset" id="input-data-for-step-1">
<a name="input_settings"></a> Input Data for Step
1<a class="anchor" aria-label="anchor" href="#input-data-for-step-1"></a>
</h3>
<p>Each sample’s AIRR-Seq data must be contained in a separate file,
with observations indexed by row, and with the same columns across
samples.</p>
<div class="section level5">
<h5 id="file-paths-of-sample-data">
<a name="files1"></a> File Paths of Sample Data<a class="anchor" aria-label="anchor" href="#file-paths-of-sample-data"></a>
</h5>
<p>The <code>file_list</code> parameter accepts a character vector
containing file paths (or a list containing file paths and connections),
where each element corresponds to a file containing a single sample.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create vector of input file paths for step 1 (one per sample)</span></span>
<span><span class="va">input_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_input_samples</span>, </span>
<span>                         <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Sample"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">samples</span>, <span class="st">".rds"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">input_files</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/tmp/RtmpBNFYpT/input_samples/Sample1.rds"</span></span>
<span><span class="co">#&gt; [2] "/tmp/RtmpBNFYpT/input_samples/Sample2.rds"</span></span>
<span><span class="co">#&gt; [3] "/tmp/RtmpBNFYpT/input_samples/Sample3.rds"</span></span>
<span><span class="co">#&gt; [4] "/tmp/RtmpBNFYpT/input_samples/Sample4.rds"</span></span>
<span><span class="co">#&gt; [5] "/tmp/RtmpBNFYpT/input_samples/Sample5.rds"</span></span>
<span><span class="co">#&gt; [6] "/tmp/RtmpBNFYpT/input_samples/Sample6.rds"</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="file-format-of-sample-data">
<a name="input_type"></a> File Format of Sample Data<a class="anchor" aria-label="anchor" href="#file-format-of-sample-data"></a>
</h5>
<p>The file format of the input files is specified by the
<code>input_type</code> parameter. The supported values are
<code>"rds"</code>, <code>"rda"</code>, <code>"csv"</code>,
<code>"csv2"</code>, <code>"tsv"</code> and <code>"table"</code>.
Depending on the input type, further options are specified with
<code>data_symbols</code> or <code>read.args</code>.</p>
<p>Refer <a href="https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/articles/supplementary.html#load">here</a>
and to <code><a href="../reference/combineSamples.html">loadDataFromFileList()</a></code> for details and examples.</p>
</div>
<div class="section level5">
<h5 id="sequence-column-in-sample-data">
<a name="seq_col"></a> Sequence Column in Sample Data<a class="anchor" aria-label="anchor" href="#sequence-column-in-sample-data"></a>
</h5>
<p>The <code>seq_col</code> parameter specifies the column containing
the TCR/BCR sequences within each sample. It accepts the column name (as
a character string) or the column position index.</p>
</div>
<div class="section level5">
<h5 id="count-column-in-sample-data">
<a name="count_col"></a> Count Column in Sample Data<a class="anchor" aria-label="anchor" href="#count-column-in-sample-data"></a>
</h5>
<p>The optional <code>count_col</code> parameter specifies the column
containing the clone count (clonal abundance) within each sample. It
accepts the column name (as a character string) or the column position
index. If provided, clone counts <a href="#minimum-clone-count">will be
considered when filtering the clusters</a>.</p>
</div>
<div class="section level5">
<h5 id="custom-sample-ids-optional">
<a name="sample_ids"></a> Custom Sample IDs (Optional)<a class="anchor" aria-label="anchor" href="#custom-sample-ids-optional"></a>
</h5>
<p>Each clone’s sample ID is included in the output. By default, these
are <code>"Sample1"</code>, <code>"Sample2"</code>, etc., according to
the order in <code>file_list</code>.</p>
<p>The optional <code>sample_ids</code> parameter assigns custom sample
IDs. It accepts a vector of the same length as <code>file_list</code>,
where each entry is the corresponding sample ID.</p>
</div>
<div class="section level5">
<h5 id="filtering-the-sample-data">Filtering the Sample Data<a class="anchor" aria-label="anchor" href="#filtering-the-sample-data"></a>
</h5>
<p>The clones from each sample are filtered to remove any irrelevant
data. By default, clones with sequences that are less than three
characters in length, as well as sequences containing any of the
characters <code>*</code>, <code>_</code> or <code>|</code>, will be
excluded. The <code>min_seq_length</code> and <code>drop_matches</code>
parameters control the filter settings. Refer <a href="https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/articles/buildRepSeqNetwork.html#input_options">here</a>
for details.</p>
</div>
<div class="section level5">
<h5 class="tabset" id="construction-of-sample-networks">
<a name="network_settings"></a> Construction of
Sample Networks<a class="anchor" aria-label="anchor" href="#construction-of-sample-networks"></a>
</h5>
<p>The parameters that control the construction of each sample’s network
are shown below along with their default values.</p>
<ul>
<li><code>dist_type = "hamming"</code></li>
<li><code>dist_cutoff = 1</code></li>
<li><code>drop_isolated_nodes = TRUE</code></li>
</ul>
<p>Refer <a href="https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/articles/buildRepSeqNetwork.html#network_settings">here</a>
for their meaning and usage.</p>
</div>
<div class="section level5">
<h5 id="clustering-algorithm-for-sample-networks">Clustering Algorithm for Sample Networks<a class="anchor" aria-label="anchor" href="#clustering-algorithm-for-sample-networks"></a>
</h5>
<p>By default, clustering within each sample’s network is performed
using <code><a href="https://r.igraph.org/reference/cluster_fast_greedy.html" class="external-link">igraph::cluster_fast_greedy()</a></code>. A different clustering
algorithm can be specified using the <code>cluster_fun</code> parameter,
as described <a href="https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/articles/cluster_analysis.html#clustering-algorithm">here</a>.</p>
</div>
</div>
<div class="section level3">
<h3 class="tabset" id="filtering-the-sample-clusters">Filtering the Sample Clusters<a class="anchor" aria-label="anchor" href="#filtering-the-sample-clusters"></a>
</h3>
<p>The following parameters control the criteria used to select clusters
from each sample.</p>
<div class="section level5">
<h5 id="top-n-clusters">Top <span class="math inline">\(n\)</span> Clusters<a class="anchor" aria-label="anchor" href="#top-n-clusters"></a>
</h5>
<p>Within each sample, the <span class="math inline">\(n = 20\)</span>
clusters with the greatest node count are automatically selected. The
value of <span class="math inline">\(n\)</span> can be adjusted using
the <code>top_n_clusters</code> parameter.</p>
</div>
<div class="section level5">
<h5 id="minimum-node-count">Minimum Node Count<a class="anchor" aria-label="anchor" href="#minimum-node-count"></a>
</h5>
<p>By default, any cluster containing at least ten nodes will be
selected This value can be adjusted using the
<code>min_node_count</code> parameter.</p>
</div>
<div class="section level5">
<h5 id="minimum-clone-count">Minimum Clone Count<a class="anchor" aria-label="anchor" href="#minimum-clone-count"></a>
</h5>
<p>By default, any cluster with an aggregate clone count (summed over
all nodes) of at least 100 will be selected. This value can be adjusted
using the <code>min_clone_count</code> parameter.</p>
<p>This criterion only applies if <a href="#count_col">clone counts are
provided</a> using the <code>count_col</code> parameter.</p>
</div>
</div>
<div class="section level3">
<h3 class="tabset" id="output-settings-for-step-1">Output Settings for Step 1<a class="anchor" aria-label="anchor" href="#output-settings-for-step-1"></a>
</h3>
<p><code><a href="../reference/findPublicClusters.html">findPublicClusters()</a></code> does not return any direct output.
Instead, data for the selected clusters is saved to files to be used as
inputs in step 2. The following parameters control the output
settings.</p>
<div class="section level5">
<h5 id="variables-to-keep-from-sample-data">
<a name="subset_cols"></a> Variables to Keep From Sample Data<a class="anchor" aria-label="anchor" href="#variables-to-keep-from-sample-data"></a>
</h5>
<p>By default, the output includes all variables from the original
sample data. These variables can be <a href="#vis">used later as
metadata in visualizations</a> of the global network.</p>
<p>To keep only a subset of the original variables, specify the
variables to keep using the <code>subset_cols</code> parameter, which
accepts a character vector of column names or a vector of column
indices. The sequence column is always included.</p>
</div>
<div class="section level5">
<h5 id="output-directory-for-step-1">
<a name="dir_out1"></a> Output Directory for Step 1<a class="anchor" aria-label="anchor" href="#output-directory-for-step-1"></a>
</h5>
<p>The <code>output_dir</code> parameter specifies the output directory.
It accepts a character string containing the directory path. The
directory will be created if it does not exist.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create output directory path for step 1</span></span>
<span><span class="va">dir_filtered_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"filtered_samples"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="output-file-format-for-step-1">Output File Format for Step 1<a class="anchor" aria-label="anchor" href="#output-file-format-for-step-1"></a>
</h5>
<p>By default, each file is saved as an RDS file. This can be changed
using the <code>output_type</code> parameter. Other accepted values are
<code>"rda"</code> and <code>"csv"</code>.</p>
</div>
<div class="section level5">
<h5 id="saving-full-networks-for-each-sample-optional">
<a name="save_unfiltered"></a> Saving Full Networks for Each Sample
(Optional)<a class="anchor" aria-label="anchor" href="#saving-full-networks-for-each-sample-optional"></a>
</h5>
<p>By default, <code><a href="../reference/findPublicClusters.html">findPublicClusters()</a></code> saves data only for the
selected clusters from each sample. If desired, data for each sample’s
entire network can also be saved by passing a directory path to the
<code>output_dir_unfiltered</code> parameter. The full network data for
each sample is the <a href="https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/articles/buildRepSeqNetwork.html#base-output">output
returned by <code>buildNet()</code></a>. The
<code>output_type_unfiltered</code> parameter specifies the file format
in the same manner described [here]((<a href="https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/articles/buildRepSeqNetwork.html#output-file-format" class="uri">https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/articles/buildRepSeqNetwork.html#output-file-format</a>)
for the <code>output_type</code> parameter of
<code><a href="../reference/buildRepSeqNetwork.html">buildNet()</a></code>.</p>
</div>
<div class="section level5">
<h5 id="visualization-of-sample-networks-optional">Visualization of Sample Networks (Optional)<a class="anchor" aria-label="anchor" href="#visualization-of-sample-networks-optional"></a>
</h5>
<p>By default, <code><a href="../reference/findPublicClusters.html">findPublicClusters()</a></code> does not produce visual
plots. The visualization of interest is of the global network in <a href="#step2">step 2</a>.</p>
<p>A plot of each sample’s full network can be produced using
<code>plots = TRUE</code>. Specifying <code>print_plots = TRUE</code>
prints these to the R plotting window. The plots will be saved if <a href="#save_unfiltered"><code>output_dir_unfiltered</code></a> is
non-null. By default, the nodes in each plot are colored according to
cluster membership. A different variable can be specified using the
<code>color_nodes_by</code> parameter as detailed <a href="https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/articles/network_visualization.html#node-colors">here</a>
(or <a href="https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/articles/network_visualization.html#generating-multiple-plots">here</a>
for multiple variables).</p>
<p>Refer <a href="https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/articles/network_visualization.html">here</a>
to learn about other parameters for customizing the visualization.</p>
</div>
</div>
<div class="section level3">
<h3 id="demonstration-step-1">
<a name="demo1"></a> Demonstration, Step 1<a class="anchor" aria-label="anchor" href="#demonstration-step-1"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/findPublicClusters.html">findPublicClusters</a></span><span class="op">(</span><span class="va">input_files</span>, </span>
<span>                   input_type <span class="op">=</span> <span class="st">"rds"</span>,</span>
<span>                   seq_col <span class="op">=</span> <span class="st">"CloneSeq"</span>, </span>
<span>                   count_col <span class="op">=</span> <span class="st">"CloneCount"</span>,</span>
<span>                   min_seq_length <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>                   drop_matches <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                   top_n_clusters <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                   min_node_count <span class="op">=</span> <span class="fl">5</span>, </span>
<span>                   min_clone_count <span class="op">=</span> <span class="fl">15000</span>,</span>
<span>                   output_dir <span class="op">=</span> <span class="va">dir_filtered_samples</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><a name="filtered_node_data"></a> <a name="node_meta"></a></p>
<p>Two new directories are created within the specified output
directory:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">dir_filtered_samples</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "cluster_meta_data" "node_meta_data"</span></span></code></pre></div>
<p>These directories contain cluster-level and node-level metadata,
respectively, for the selected clusters from each sample. We require
only the node metadata for step 2.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_filtered_samples</span>, <span class="st">"node_meta_data"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1_Sample1.rds"   "10_Sample10.rds" "11_Sample11.rds" "12_Sample12.rds"</span></span>
<span><span class="co">#&gt; [5] "13_Sample13.rds" "14_Sample14.rds"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 class="tabset" id="step-2-global-network-of-public-clusters">
<a name="step2"></a> Step 2: Global Network of Public
Clusters<a class="anchor" aria-label="anchor" href="#step-2-global-network-of-public-clusters"></a>
</h2>
<p><code><a href="../reference/buildPublicClusterNetwork.html">buildPublicClusterNetwork()</a></code> combines the selected
clusters from all samples into a single global network, where a new
round of cluster analysis is performed to partition the global network
into clusters.</p>
<div class="section level3">
<h3 id="input-data-for-step-2">Input Data for Step 2<a class="anchor" aria-label="anchor" href="#input-data-for-step-2"></a>
</h3>
<p>The input files for <code><a href="../reference/buildPublicClusterNetwork.html">buildPublicClusterNetwork()</a></code> are the
<a href="#demo1">node metadata files</a> from the output of step 1. Each
file contains data for one sample.</p>
<div class="section level5">
<h5 id="file-paths-of-node-metadata-from-step-1">
<a name="files2"></a> File Paths of Node Metadata From Step 1<a class="anchor" aria-label="anchor" href="#file-paths-of-node-metadata-from-step-1"></a>
</h5>
<p>The <code>file_list</code> parameter accepts a character vector of
file paths for the input files, which are located in the
<code>node_meta_data</code> <a href="#demo1">subdirectory</a> of the <a href="#dir_out1">output directory from step 1</a>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Directory of node metadata from step 1</span></span>
<span><span class="va">dir_filtered_samples_node</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_filtered_samples</span>, <span class="st">"node_meta_data"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Vector of file paths to node metadata from step 1</span></span>
<span><span class="va">files_filtered_samples_node</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">dir_filtered_samples_node</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="file-format-of-node-metadata-from-step-1">File Format of Node Metadata From Step 1<a class="anchor" aria-label="anchor" href="#file-format-of-node-metadata-from-step-1"></a>
</h5>
<p>If <code><a href="../reference/findPublicClusters.html">findPublicClusters()</a></code> was called with a non-default
value of <code>output_type</code>, this value must be passed to the
<code>input_type</code> parameter of
<code><a href="../reference/buildPublicClusterNetwork.html">buildPublicClusterNetwork()</a></code>.</p>
</div>
<div class="section level5">
<h5 id="argument-values-from-step-1">Argument Values From Step 1<a class="anchor" aria-label="anchor" href="#argument-values-from-step-1"></a>
</h5>
<p>The <code>seq_col</code> and <code>count_col</code> parameters
specify the input data columns containing receptor sequences and clone
counts, respectively. Users should pass the same argument values to
these parameters as they did when calling
<code><a href="../reference/findPublicClusters.html">findPublicClusters()</a></code> during step 1.</p>
</div>
</div>
<div class="section level3">
<h3 class="tabset" id="global-network-analysis">Global Network Analysis<a class="anchor" aria-label="anchor" href="#global-network-analysis"></a>
</h3>
<div class="section level5">
<h5 id="network-construction">Network Construction<a class="anchor" aria-label="anchor" href="#network-construction"></a>
</h5>
<p>The parameters that control construction of the global network are
shown below along with their default values.</p>
<ul>
<li><code>dist_type = "hamming"</code></li>
<li><code>dist_cutoff = 1</code></li>
<li><code>drop_isolated_nodes = FALSE</code></li>
</ul>
<p>Refer <a href="https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/articles/buildRepSeqNetwork.html#network_settings">here</a>
for their meaning and usage.</p>
</div>
<div class="section level5">
<h5 id="clustering-algorithm-for-global-network">Clustering Algorithm for Global Network<a class="anchor" aria-label="anchor" href="#clustering-algorithm-for-global-network"></a>
</h5>
<p>A clustering algorithm is used to partition the global network graph
into densely-connected subgraphs (clusters). Each cluster can contain
clones from different samples.</p>
<p>By default, clustering within is performed using
<code><a href="https://r.igraph.org/reference/cluster_fast_greedy.html" class="external-link">igraph::cluster_fast_greedy()</a></code>. A different clustering
algorithm can be specified using the <code>cluster_fun</code> parameter,
as described <a href="https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/articles/cluster_analysis.html#clustering-algorithm">here</a>.</p>
</div>
<div class="section level5">
<h5 id="visualization-of-global-network">
<a name="vis"></a> Visualization of Global Network<a class="anchor" aria-label="anchor" href="#visualization-of-global-network"></a>
</h5>
<p>By default, <code><a href="../reference/buildPublicClusterNetwork.html">buildPublicClusterNetwork()</a></code> produces a
visual plot of the global network graph with the nodes colored according
to sample ID.</p>
<p>The <code>color_nodes_by</code> parameter specifies the variable used
to color the nodes. It accepts a character string naming a variable <a href="#subset_cols">kept</a> from the original sample data or one of the
node-level network properties <a href="#node_variables">listed
here</a>.</p>
<p><code>color_nodes_by</code> also accepts a vector naming multiple
variables. <a href="https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/articles/network_visualization.html#generating-multiple-plots">One
plot will be created for each entry, with the nodes colored according to
the respective variable</a>.</p>
<p>Refer <a href="https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/articles/network_visualization.html">here</a>
to learn about other parameters for customizing the visualization.</p>
</div>
</div>
<div class="section level3">
<h3 class="tabset" id="output-settings-for-step-2">Output Settings for Step 2<a class="anchor" aria-label="anchor" href="#output-settings-for-step-2"></a>
</h3>
<p><code><a href="../reference/buildPublicClusterNetwork.html">buildPublicClusterNetwork()</a></code> returns a list containing
plots, metadata and other network objects, with the <a href="https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/articles/buildRepSeqNetwork.html#base-output">same
structure</a> as the output of <code><a href="../reference/buildRepSeqNetwork.html">buildRepSeqNetwork()</a></code>.</p>
<p>The output can be saved to a local directory using the parameters
<code>output_dir</code>, <code>output_type</code> and
<code>output_name</code>, whose usage is described <a href="https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/articles/buildRepSeqNetwork.html#output-directory">here</a>.</p>
</div>
<div class="section level3">
<h3 id="demonstration-step-2">
<a name="demo2"></a> Demonstration, Step 2<a class="anchor" aria-label="anchor" href="#demonstration-step-2"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">public_clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildPublicClusterNetwork.html">buildPublicClusterNetwork</a></span><span class="op">(</span><span class="va">files_filtered_samples_node</span>,</span>
<span>                                             seq_col <span class="op">=</span> <span class="st">"CloneSeq"</span>, </span>
<span>                                             count_col <span class="op">=</span> <span class="st">"CloneCount"</span>,</span>
<span>                                             size_nodes_by <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                             print_plots <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="public_clusters_files/figure-html/unnamed-chunk-9-1.png" width="100%" style="display: block; margin: auto;">
The returned list contains the following elements:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">public_clusters</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "details"          "igraph"           "adjacency_matrix" "node_data"       </span></span>
<span><span class="co">#&gt; [5] "cluster_data"     "plots"</span></span></code></pre></div>
<p>The elements are described <a href="https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/articles/buildRepSeqNetwork.html#base-output">here</a>.
We inspect the node metadata and cluster metadata.</p>
<div class="section level5">
<h5 id="node-metadata-for-global-network">
<a name="node_variables"></a> Node Metadata for Global Network<a class="anchor" aria-label="anchor" href="#node-metadata-for-global-network"></a>
</h5>
<p>The list element <code>node_data</code> is a data frame containing
metadata for the network nodes, where each row represents a distinct
clone corresponding to a node in the global network graph.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">public_clusters</span><span class="op">$</span><span class="va">node_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 517</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># variables in the node-level metadata</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">public_clusters</span><span class="op">$</span><span class="va">node_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "CloneSeq"                           "CloneFrequency"                    </span></span>
<span><span class="co">#&gt;  [3] "CloneCount"                         "SampleID"                          </span></span>
<span><span class="co">#&gt;  [5] "SampleLevelNetworkDegree"           "ClusterIDInSample"                 </span></span>
<span><span class="co">#&gt;  [7] "SampleLevelTransitivity"            "SampleLevelCloseness"              </span></span>
<span><span class="co">#&gt;  [9] "SampleLevelCentralityByCloseness"   "SampleLevelEigenCentrality"        </span></span>
<span><span class="co">#&gt; [11] "SampleLevelCentralityByEigen"       "SampleLevelBetweenness"            </span></span>
<span><span class="co">#&gt; [13] "SampleLevelCentralityByBetweenness" "SampleLevelAuthorityScore"         </span></span>
<span><span class="co">#&gt; [15] "SampleLevelCoreness"                "SampleLevelPageRank"               </span></span>
<span><span class="co">#&gt; [17] "PublicNetworkDegree"                "ClusterIDPublic"                   </span></span>
<span><span class="co">#&gt; [19] "PublicTransitivity"                 "PublicCloseness"                   </span></span>
<span><span class="co">#&gt; [21] "PublicCentralityByCloseness"        "PublicEigenCentrality"             </span></span>
<span><span class="co">#&gt; [23] "PublicCentralityByEigen"            "PublicBetweenness"                 </span></span>
<span><span class="co">#&gt; [25] "PublicCentralityByBetweenness"      "PublicAuthorityScore"              </span></span>
<span><span class="co">#&gt; [27] "PublicCoreness"                     "PublicPageRank"</span></span></code></pre></div>
<p>All variables <a href="#subset_cols">kept from the original sample
data during step 1</a> are present. The variable
<code>ClusterIDPublic</code> contains the global cluster membership,
while <code>ClusterIDInSample</code> contains the in-sample cluster
membership. <a href="https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/articles/buildRepSeqNetwork.html#node-level-network-properties">Node-level
network properties</a> are also present. Those beginning with
<code>SampleLevel</code> correspond to the sample networks, while those
beginning with <code>Public</code> correspond to the global network.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View some of the node metadata for the global network</span></span>
<span><span class="va">view_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CloneSeq"</span>, <span class="st">"SampleID"</span>, <span class="st">"ClusterIDInSample"</span>, <span class="st">"ClusterIDPublic"</span><span class="op">)</span></span>
<span><span class="va">public_clusters</span><span class="op">$</span><span class="va">node_data</span><span class="op">[</span><span class="fl">49</span><span class="op">:</span><span class="fl">54</span> , <span class="va">view_cols</span><span class="op">]</span></span>
<span><span class="co">#&gt;                   CloneSeq SampleID ClusterIDInSample ClusterIDPublic</span></span>
<span><span class="co">#&gt; Sample11.27    CASSGAYEQYF Sample11                 3               2</span></span>
<span><span class="co">#&gt; Sample11.29 CASSYLTGYNEQFF Sample11                 1              11</span></span>
<span><span class="co">#&gt; Sample11.30    CAWSSQETQYF Sample11                 4               4</span></span>
<span><span class="co">#&gt; Sample12.6   CASSLNGYNEQFF Sample12                 1              12</span></span>
<span><span class="co">#&gt; Sample12.11 CASSYLTGYNEQFF Sample12                 2              11</span></span>
<span><span class="co">#&gt; Sample12.14  CASSLNGYNEQFF Sample12                 1              12</span></span></code></pre></div>
<p>The row names indicate the original row ID of each clone within its
sample’s data.</p>
</div>
<div class="section level5">
<h5 id="cluster-metadata-for-global-network">
<a name="cluster_variables"></a> Cluster Metadata for Global
Network<a class="anchor" aria-label="anchor" href="#cluster-metadata-for-global-network"></a>
</h5>
<p>The list element <code>cluster_data</code> is a data frame containing
metadata for the public clusters, where each row corresponds to a
cluster in the global network.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># variables in the cluster-level metadata</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">public_clusters</span><span class="op">$</span><span class="va">cluster_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "cluster_id"                  "node_count"                 </span></span>
<span><span class="co">#&gt;  [3] "mean_seq_length"             "mean_degree"                </span></span>
<span><span class="co">#&gt;  [5] "max_degree"                  "seq_w_max_degree"           </span></span>
<span><span class="co">#&gt;  [7] "agg_count"                   "max_count"                  </span></span>
<span><span class="co">#&gt;  [9] "seq_w_max_count"             "diameter_length"            </span></span>
<span><span class="co">#&gt; [11] "global_transitivity"         "assortativity"              </span></span>
<span><span class="co">#&gt; [13] "edge_density"                "degree_centrality_index"    </span></span>
<span><span class="co">#&gt; [15] "closeness_centrality_index"  "eigen_centrality_index"     </span></span>
<span><span class="co">#&gt; [17] "eigen_centrality_eigenvalue"</span></span></code></pre></div>
<p>Refer <a href="https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/articles/buildRepSeqNetwork.html#cluster-level-network-properties">here</a>
for more information about the cluster-level network properties.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View some of the cluster metadata for the global network</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">public_clusters</span><span class="op">$</span><span class="va">cluster_data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;   cluster_id node_count mean_seq_length mean_degree max_degree seq_w_max_degree</span></span>
<span><span class="co">#&gt; 1          1         96              15          95         95  CASSYTGGGNQPQHF</span></span>
<span><span class="co">#&gt; 2          2         75              11          74         74      CASSGAYEQYF</span></span>
<span><span class="co">#&gt; 3          3         73              11          72         72      CASSSPETQYF</span></span>
<span><span class="co">#&gt; 4          4         66              11          65         65      CAWSSQETQYF</span></span>
<span><span class="co">#&gt; 5          5         61              14          60         60   CSVDLGKGNNEQFF</span></span>
<span><span class="co">#&gt; 6          6         27              16          26         26 CASSIEGQLSTDTQYF</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 class="tabset" id="step-3-additional-tasks">
<a name="step3"></a> Step 3: Additional Tasks<a class="anchor" aria-label="anchor" href="#step-3-additional-tasks"></a>
</h2>
<p>After calling <code><a href="../reference/buildPublicClusterNetwork.html">buildPublicClusterNetwork()</a></code>, the following
tasks can be performed using the returned output.</p>
<div class="section level3">
<h3 id="labeling-the-global-clusters">Labeling the Global Clusters<a class="anchor" aria-label="anchor" href="#labeling-the-global-clusters"></a>
</h3>
<p>In order to more easily cross-reference the clusters in the visual
plot with the clusters in the data, we can label the clusters with their
ID numbers.</p>
<p>This is accomplished using <code><a href="../reference/addClusterLabels.html">labelClusters()</a></code> as described
<a href="https://mlizhangx.github.io/Network-Analysis-for-Repertoire-Sequencing-/articles/cluster_analysis.html#labeling-clusters">here</a>.</p>
<p>Below, we label the six largest clusters in the plot with their
cluster IDs. The node metadata variable <code>ClusterIDPublic</code>
contains the global cluster membership, so we pass its name to the
<code>cluster_id_col</code> parameter.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">public_clusters</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/addClusterLabels.html">labelClusters</a></span><span class="op">(</span><span class="va">public_clusters</span>,</span>
<span>                top_n_clusters <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                cluster_id_col <span class="op">=</span> <span class="st">"ClusterIDPublic"</span>,</span>
<span>                size <span class="op">=</span> <span class="fl">7</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">public_clusters</span><span class="op">$</span><span class="va">plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; Warning: Removed 511 rows containing missing values (`geom_text()`).</span></span></code></pre></div>
<p><img src="public_clusters_files/figure-html/unnamed-chunk-16-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="focusing-on-individual-clusters">Focusing on Individual Clusters<a class="anchor" aria-label="anchor" href="#focusing-on-individual-clusters"></a>
</h3>
<p>To focus on a particular cluster, we can subset the node metadata
based on the value of <code>ClusterIDPublic</code> and use
<code><a href="../reference/buildRepSeqNetwork.html">buildNet()</a></code> to produce plots of the cluster’s graph.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># focus on cluster 1</span></span>
<span><span class="fu"><a href="../reference/buildRepSeqNetwork.html">buildNet</a></span><span class="op">(</span></span>
<span>  <span class="va">public_clusters</span><span class="op">$</span><span class="va">node_data</span><span class="op">[</span><span class="va">public_clusters</span><span class="op">$</span><span class="va">node_data</span><span class="op">$</span><span class="va">ClusterIDPublic</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span>,</span>
<span>  <span class="st">"CloneSeq"</span>, </span>
<span>  color_nodes_by <span class="op">=</span> <span class="st">"CloneSeq"</span>, </span>
<span>  size_nodes_by <span class="op">=</span> <span class="fl">3</span>, </span>
<span>  output_name <span class="op">=</span> <span class="st">"Cluster 1"</span>,</span>
<span>  print_plots <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in .checkOutputName(output_name, "MyRepSeqNetwork"): value for</span></span>
<span><span class="co">#&gt; 'output_name' may be unsafe for use as a file name prefix. Value changed to</span></span>
<span><span class="co">#&gt; "Cluster_1"</span></span></code></pre></div>
<p><img src="public_clusters_files/figure-html/unnamed-chunk-17-1.png" width="100%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># focus on cluster 6</span></span>
<span><span class="fu"><a href="../reference/buildRepSeqNetwork.html">buildNet</a></span><span class="op">(</span></span>
<span>  <span class="va">public_clusters</span><span class="op">$</span><span class="va">node_data</span><span class="op">[</span><span class="va">public_clusters</span><span class="op">$</span><span class="va">node_data</span><span class="op">$</span><span class="va">ClusterIDPublic</span> <span class="op">==</span> <span class="fl">6</span>, <span class="op">]</span>,</span>
<span>  <span class="st">"CloneSeq"</span>, </span>
<span>  color_nodes_by <span class="op">=</span> <span class="st">"CloneSeq"</span>, </span>
<span>  color_scheme <span class="op">=</span> <span class="st">"plasma"</span>, </span>
<span>  size_nodes_by <span class="op">=</span> <span class="fl">4</span>, </span>
<span>  output_name <span class="op">=</span> <span class="st">"Cluster 6"</span>,</span>
<span>  print_plots <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in .checkOutputName(output_name, "MyRepSeqNetwork"): value for</span></span>
<span><span class="co">#&gt; 'output_name' may be unsafe for use as a file name prefix. Value changed to</span></span>
<span><span class="co">#&gt; "Cluster_6"</span></span></code></pre></div>
<p><img src="public_clusters_files/figure-html/unnamed-chunk-18-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Brian Neal, Hai Yang, Phi Long Le, Li Zhang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
